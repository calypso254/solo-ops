<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Ops Manual</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root { --bg: #1e1e1e; --text: #e0e0e0; --panel: #2d2d2d; --border: #444; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        /* Layout */
        .container { max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn { cursor: pointer; background: #444; border: none; color: white; padding: 8px 16px; border-radius: 4px; }
        .btn:hover { background: #555; }
        
        /* The List */
        .layer-list { list-style: none; padding: 0; min-height: 50px; }
        .layer-list .layer-list { padding-left: 25px; border-left: 1px solid #555; margin-top: 5px; }
        
        /* The Items (Photoshop Layer Style) */
        .layer-item { background: var(--panel); margin-bottom: 5px; border: 1px solid var(--border); border-radius: 4px; padding: 10px; display: flex; align-items: center; justify-content: space-between; }
        .layer-content { display: flex; align-items: center; flex-grow: 1; gap: 10px; cursor: grab; }
        .layer-title { font-weight: 500; outline: none; border: none; background: transparent; color: white; width: 100%; }
        
        /* Status Indicators */
        .status-dot { width: 16px; height: 16px; border-radius: 50%; cursor: pointer; border: 2px solid #555; flex-shrink: 0; }
        .status-red { background-color: #ff5f56; box-shadow: 0 0 5px #ff5f56; }      /* Not Started */
        .status-blue { background-color: #2196f3; box-shadow: 0 0 5px #2196f3; }     /* In Progress */
        .status-yellow { background-color: #ffeb3b; box-shadow: 0 0 5px #ffeb3b; }   /* Blocked */
        .status-green { background-color: #4caf50; box-shadow: 0 0 5px #4caf50; }    /* Done */

        /* Controls */
        .actions { opacity: 0.3; transition: 0.2s; }
        .layer-item:hover .actions { opacity: 1; }
        .delete-btn { color: #ff5f56; cursor: pointer; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ðŸš€ Product Launch Ops</h2>
        <div>
            <button class="btn" onclick="addItem()">+ New Task</button>
            <button class="btn" onclick="saveData()">Save Manual</button>
        </div>
    </div>
    <ul id="rootList" class="layer-list">
        </ul>
</div>

<script>
    const root = document.getElementById('rootList');

    // 1. Initialize SortableJS for Drag and Drop
    function initSortable(el) {
        new Sortable(el, {
            group: 'nested', // Allows dragging between lists
            animation: 150,
            fallbackOnBody: true,
            swapThreshold: 0.65,
            onEnd: function (evt) {
                // If dragged slightly right, nest it under the item above
                // Note: Full auto-nesting logic is complex, this is a simplified visual stack
                saveData(); 
            }
        });
    }

    // 2. Create a Layer Item
    function createLayerHTML(text = "New Task", status = "red", children = []) {
        const li = document.createElement('li');
        
        // Define status colors
        const colors = ['red', 'blue', 'yellow', 'green'];
        
        li.innerHTML = `
            <div class="layer-item">
                <div class="layer-content">
                    <div class="status-dot status-${status}" onclick="cycleStatus(this)"></div>
                    <input class="layer-title" value="${text}" onchange="saveData()" placeholder="Task Name...">
                </div>
                <div class="actions">
                    <span class="delete-btn" onclick="deleteItem(this)">âœ–</span>
                </div>
            </div>
            <ul class="layer-list"></ul>
        `;

        // Initialize sortable for the sub-list immediately
        initSortable(li.querySelector('.layer-list'));
        return li;
    }

    // 3. Add New Item
    function addItem(targetList = root, text, status) {
        const item = createLayerHTML(text, status);
        targetList.appendChild(item);
        saveData();
    }

    // 4. Cycle Status Colors (Red -> Blue -> Yellow -> Green)
    function cycleStatus(dot) {
        const classes = ['status-red', 'status-blue', 'status-yellow', 'status-green'];
        let currentClass = classes.find(c => dot.classList.contains(c));
        let nextIndex = (classes.indexOf(currentClass) + 1) % classes.length;
        
        dot.classList.remove(currentClass);
        dot.classList.add(classes[nextIndex]);
        saveData();
    }

    // 5. Delete Item
    function deleteItem(btn) {
        if(confirm('Delete this task and its subtasks?')) {
            btn.closest('li').remove();
            saveData();
        }
    }

    // 6. Save to LocalStorage
    function saveData() {
        const data = serializeList(root);
        localStorage.setItem('opsManualData', JSON.stringify(data));
    }

    function serializeList(list) {
        let items = [];
        list.querySelectorAll(':scope > li').forEach(li => {
            let title = li.querySelector('.layer-title').value;
            let dot = li.querySelector('.status-dot');
            let status = 'red';
            if (dot.classList.contains('status-blue')) status = 'blue';
            if (dot.classList.contains('status-yellow')) status = 'yellow';
            if (dot.classList.contains('status-green')) status = 'green';

            items.push({
                title: title,
                status: status,
                children: serializeList(li.querySelector('ul'))
            });
        });
        return items;
    }

    // 7. Load Data on Startup
    function loadData() {
        const data = JSON.parse(localStorage.getItem('opsManualData'));
        if (data) {
            rebuildList(root, data);
        } else {
            // Default Template
            addItem(root, "Product Launch v1.0", "blue"); 
        }
    }

    function rebuildList(container, items) {
        items.forEach(item => {
            const li = createLayerHTML(item.title, item.status);
            container.appendChild(li);
            if (item.children && item.children.length > 0) {
                rebuildList(li.querySelector('ul'), item.children);
            }
        });
    }

    // Initialize
    initSortable(root);
    loadData();
</script>
</body>
</html>
